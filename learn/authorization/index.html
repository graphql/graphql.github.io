<!DOCTYPE html><html><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/><title>Authorization | GraphQL</title><meta name="viewport" content="width=640"/><meta property="og:title" content="GraphQL: A query language for APIs."/><meta property="og:description" content="GraphQL provides a complete description of the data in your API, gives clients the power to ask for exactly what they need and nothing more, makes it easier to evolve APIs over time, and enables powerful developer tools."/><meta property="og:type" content="website"/><meta property="og:url" content="http://graphql.org/"/><meta property="og:image" content="/img/og_image.png"/><meta property="og:image:type" content="image/png"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@graphql"/><meta name="twitter:title" content="GraphQL: A query language for APIs."/><meta name="twitter:description" content="GraphQL gives clients the power to ask for exactly what they need and nothing more, making it easier to evolve APIs over time."/><meta name="twitter:image" content="/img/twitter_image.png"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="home" type="application/rss+xml" href="/blog/rss.xml" title="GraphQL Team Blog"/><link rel="stylesheet" href="/style.css"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Rubik:300|Roboto:300"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,400i,600"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/></head><body><header><section><a class="nav-home" href="/"><img class="nav-logo" src="/img/logo.svg" width="30" height="30"/>GraphQL</a><nav><a href="/learn/">Learn</a><a href="/code/">Code</a><a href="/community/">Community</a><a href="/blog/">Blog</a><a href="http://facebook.github.io/graphql/" target="_blank" rel="noopener noreferrer">Spec</a></nav><div class="algolia-search-wrapper"><input type="text" id="algolia-search-input" placeholder="Search docs..."/></div></section></header><section><div class="documentationContent"><div class="inner-content"><h1>Authorization</h1><div><blockquote><p>Delegate authorization logic to the business logic layer</p></blockquote><p>Authorization is a type of business logic that describes whether a given user/session/context has permission to perform an action or see a piece of data. For example:</p><p><em>“Only authors can see their drafts”</em></p><p>Enforcing this kind of behavior should happen in the <a href="/learn/thinking-in-graphs/#business-logic-layer">business logic layer</a>. It is tempting to place authorization logic in the GraphQL layer like so:</p><pre class="prism language-javascript"><span class="keyword">var</span> postType <span class="operator">=</span> <span class="keyword">new</span> <span class="class-name">GraphQLObjectType</span><span class="punctuation">(</span><span class="punctuation">{</span>
  name<span class="punctuation">:</span> ‘Post’<span class="punctuation">,</span>
  fields<span class="punctuation">:</span> <span class="punctuation">{</span>
    body<span class="punctuation">:</span> <span class="punctuation">{</span>
      type<span class="punctuation">:</span> GraphQLString<span class="punctuation">,</span>
      resolve<span class="punctuation">:</span> <span class="punctuation">(</span>post<span class="punctuation">,</span> args<span class="punctuation">,</span> context<span class="punctuation">,</span> <span class="punctuation">{</span> rootValue <span class="punctuation">}</span><span class="punctuation">)</span> <span class="operator">=</span><span class="operator">&gt;</span> <span class="punctuation">{</span>
        <span spellcheck="true" class="comment">// return the post body only if the user is the post&#x27;s author</span>
        <span class="keyword">if</span> <span class="punctuation">(</span>context<span class="punctuation">.</span>user <span class="operator">&amp;&amp;</span> <span class="punctuation">(</span>context<span class="punctuation">.</span>user<span class="punctuation">.</span>id <span class="operator">===</span> post<span class="punctuation">.</span>authorId<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">{</span>
          <span class="keyword">return</span> post<span class="punctuation">.</span>body<span class="punctuation">;</span>
        <span class="punctuation">}</span>
        <span class="keyword">return</span> <span class="keyword">null</span><span class="punctuation">;</span>
      <span class="punctuation">}</span>
    <span class="punctuation">}</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span></pre><p>Notice that we define “author owns a post&quot; by checking whether the post&#x27;s <code>authorId</code> field equals the current user’s <code>id</code>. Can you spot the problem? We would need to duplicate this code for each entry point into the service. Then if the authorization logic is not kept perfectly in sync, users could see different data depending on which API they use. Yikes! We can avoid that by having a <a href="/learn/thinking-in-graphs/#business-logic-layer">single source of truth</a> for authorization.</p><p>Defining authorization logic inside the resolver is fine when learning GraphQL or prototyping. However, for a production codebase, delegate authorization logic to the business logic layer. Here’s an example:</p><pre class="prism language-javascript"><span spellcheck="true" class="comment">//Authorization logic lives inside postRepository</span>
<span class="keyword">var</span> postRepository <span class="operator">=</span> <span class="function">require</span><span class="punctuation">(</span><span class="string">&#x27;postRepository&#x27;</span><span class="punctuation">)</span><span class="punctuation">;</span>

<span class="keyword">var</span> postType <span class="operator">=</span> <span class="keyword">new</span> <span class="class-name">GraphQLObjectType</span><span class="punctuation">(</span><span class="punctuation">{</span>
  name<span class="punctuation">:</span> ‘Post’<span class="punctuation">,</span>
  fields<span class="punctuation">:</span> <span class="punctuation">{</span>
    body<span class="punctuation">:</span> <span class="punctuation">{</span>
      type<span class="punctuation">:</span> GraphQLString<span class="punctuation">,</span>
      resolve<span class="punctuation">:</span> <span class="punctuation">(</span>post<span class="punctuation">,</span> args<span class="punctuation">,</span> context<span class="punctuation">,</span> <span class="punctuation">{</span> rootValue <span class="punctuation">}</span><span class="punctuation">)</span> <span class="operator">=</span><span class="operator">&gt;</span> <span class="punctuation">{</span>
        <span class="keyword">return</span> postRepository<span class="punctuation">.</span><span class="function">getBody</span><span class="punctuation">(</span>context<span class="punctuation">.</span>user<span class="punctuation">,</span> post<span class="punctuation">)</span><span class="punctuation">;</span>
      <span class="punctuation">}</span>
    <span class="punctuation">}</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span></pre><p>In the example above, we see that the business logic layer requires the caller to provide a user object. If you are using GraphQL.js, the User object should be populated on the <code>context</code> argument or <code>rootValue</code> in the fourth argument of the resolver.</p><p>We recommend passing a fully-hydrated User object instead of an opaque token or API key to your business logic layer. This way, we can handle the distinct concerns of <a href="/graphql-js/authentication-and-express-middleware/">authentication</a> and authorization in different stages of the request processing pipeline.</p></div><a class="read-next" href="/learn/pagination"><span class="read-next-continue">Continue Reading →</span><span class="read-next-title">Pagination</span></a></div><div class="nav-docs"><div><h3>Learn</h3><ul><li><a style="margin-left:0;" class="active" href="/learn/">Introduction</a></li><li><a style="margin-left:0;" class="active" href="/learn/queries/">Queries and Mutations</a><ul><li><a href="/learn/queries/#fields">Fields</a></li><li><a href="/learn/queries/#arguments">Arguments</a></li><li><a href="/learn/queries/#aliases">Aliases</a></li><li><a href="/learn/queries/#fragments">Fragments</a></li><li><a href="/learn/queries/#variables">Variables</a></li><li><a href="/learn/queries/#operation-name">Operation Name</a></li><li><a href="/learn/queries/#directives">Directives</a></li><li><a href="/learn/queries/#mutations">Mutations</a></li><li><a href="/learn/queries/#inline-fragments">Inline Fragments</a></li></ul></li><li><a style="margin-left:0;" class="active" href="/learn/schema/">Schemas and Types</a><ul><li><a href="/learn/schema/#type-system">Type System</a></li><li><a href="/learn/schema/#type-language">Type Language</a></li><li><a href="/learn/schema/#object-types-and-fields">Object Types and Fields</a></li><li><a href="/learn/schema/#arguments">Arguments</a></li><li><a href="/learn/schema/#the-query-and-mutation-types">The Query and Mutation Types</a></li><li><a href="/learn/schema/#scalar-types">Scalar Types</a></li><li><a href="/learn/schema/#enumeration-types">Enumeration Types</a></li><li><a href="/learn/schema/#lists-and-non-null">Lists and Non-Null</a></li><li><a href="/learn/schema/#interfaces">Interfaces</a></li><li><a href="/learn/schema/#union-types">Union Types</a></li><li><a href="/learn/schema/#input-types">Input Types</a></li></ul></li><li><a style="margin-left:0;" class="active" href="/learn/validation/">Validation</a></li><li><a style="margin-left:0;" class="active" href="/learn/execution/">Execution</a></li><li><a style="margin-left:0;" class="active" href="/learn/introspection/">Introspection</a></li></ul></div><div><h3>Best Practices</h3><ul><li><a style="margin-left:0;" class="active" href="/learn/best-practices/">Introduction</a></li><li><a style="margin-left:0;" class="active" href="/learn/thinking-in-graphs/">Thinking in Graphs</a></li><li><a style="margin-left:0;" class="active" href="/learn/serving-over-http/">Serving over HTTP</a></li><li><a style="margin-left:0;" class="active" href="/learn/authorization/">Authorization</a></li><li><a style="margin-left:0;" class="active" href="/learn/pagination/">Pagination</a></li><li><a style="margin-left:0;" class="active" href="/learn/caching/">Caching</a></li></ul></div></div></div></section><footer><section class="sitemap"><a href="/" class="nav-home"></a><div><h5><a href="/learn/">Learn</a></h5><a href="/learn/">Introduction</a><a href="/learn/queries/">Query Language</a><a href="/learn/schema/">Type System</a><a href="/learn/execution/">Execution</a><a href="/learn/best-practices/">Best Practices</a></div><div><h5><a href="/code">Code</a></h5><a href="/code/#graphql-server-libraries">Servers</a><a href="/code/#graphql-clients">Clients</a><a href="/code/#tools">Tools</a></div><div><h5><a href="/community">Community</a></h5><a href="/community/upcoming-events/">Upcoming Events</a><a href="http://stackoverflow.com/questions/tagged/graphql" target="_blank" rel="noopener noreferrer">Stack Overflow</a><a href="https://www.facebook.com/groups/graphql.community/" target="_blank" rel="noopener noreferrer">Facebook Group</a><a href="https://twitter.com/GraphQL" target="_blank" rel="noopener noreferrer">Twitter</a></div><div><h5>More</h5><a href="/blog">GraphQL Team Blog</a><a href="http://facebook.github.io/graphql/" target="_blank" rel="noopener noreferrer">Read the Spec</a><a href="https://github.com/graphql" target="_blank" rel="noopener noreferrer">GitHub</a><a href="https://github.com/graphql/graphql.github.io/edit/source/site/learn/BestPractice-Authorization.md" target="_blank" rel="noopener noreferrer">Edit this page ✎</a></div></section><a href="https://code.facebook.com/projects/" target="_blank" rel="noopener noreferrer" class="fbOpenSource"><img src="/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2016 Facebook Inc. The contents of this page are licensed BSD-3-Clause.</section></footer><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
        docsearch({
          apiKey: 'd103541f3e6041148aade2e746ed4d61',
          indexName: 'graphql',
          inputSelector: '#algolia-search-input'
        });
      </script><script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-44373548-16', 'auto');
ga('send', 'pageview');
      </script></body></html>